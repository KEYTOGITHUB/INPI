@{
    ViewBag.Title = "项目信息";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="row-content am-cf">
    <div class="row">
        <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
            <div class="widget am-cf">
                <div class="widget-head am-cf">
                    <div class="widget-title am-fl">项目信息</div>
                </div>
                <div class="widget-body am-fr">
                    <form class="am-form tpl-form-line-form" id="formProjectInfo">
                        <div class="am-form-group">
                            <label for="txtProjectCode" class="am-u-sm-3 am-form-label">项目编号 <span class="tpl-form-line-small-title">Project Code</span></label>
                            <div class="am-u-sm-9">
                                <input type="text" class="tpl-form-input" id="txtProjectCode" name="projectCode" placeholder="请输入项目编号" />
                            </div>
                        </div>

                        <div class="am-form-group">
                            <label for="txtProjectName" class="am-u-sm-3 am-form-label">项目名称 <span class="tpl-form-line-small-title">Project Name</span></label>
                            <div class="am-u-sm-9">
                                <input type="text" id="txtProjectName" class="tpl-form-input" name="projectName" placeholder="请输入项目名称" />
                            </div>
                        </div>

                        <div class="am-form-group">
                            <label for="txtCustomerName" class="am-u-sm-3 am-form-label">所属客户 <span class="tpl-form-line-small-title">Customer</span></label>
                            <div class="am-u-sm-9">
                                <input type="text" id="txtCustomerGuid" name="customerGuid" style="display:none;" />
                                <input type="text" id="txtCustomerName" class="tpl-form-input" placeholder="请选择客户" readonly data-am-modal="{target:'#customerModal'}" />
                            </div>
                        </div>

                        <div class="am-popup" id="customerModal">
                            <div class="am-popup-inner">
                                <div class="am-popup-hd">
                                    <h4 class="am-popup-title">选择客户</h4>
                                    <span data-am-modal-close
                                          class="am-close">&times;</span>
                                </div>
                                <div class="am-popup-bd">
                                    <table style="width:100%" class="am-table am-table-compact am-table-striped tpl-table-black " id="example-r">
                                        <thead>
                                            <tr>
                                                <th>用户名</th>
                                                <th>姓名</th>
                                                <th>联系方式</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (INPI.PM.Domain.CustomerService.Customer customer in ViewBag.customers)
                                            {
                                                <tr>
                                                    <td>@customer.UserName</td>
                                                    <td>@customer.RealName</td>
                                                    <td>@customer.PhoneNum</td>
                                                    <td>
                                                        <div class="tpl-table-black-operation">
                                                            <a onclick="selectCustomer('@customer.GUID','@customer.RealName')">
                                                                <i class="am-icon-pencil"></i> 选择
                                                            </a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>

                                </div>
                            </div>
                        </div>

                        <div class="am-form-group">
                            <label for="txtContact" class="am-u-sm-3 am-form-label">商务联系人 <span class="tpl-form-line-small-title">Business Contact</span></label>
                            <div class="am-u-sm-9">
                                <input type="text" id="txtContactGuid" name="contactGuid" style="display:none;" />
                                <input type="text" id="txtContactName" class="tpl-form-input" placeholder="请选择商务联系人" readonly data-am-modal="{target:'#contactModal'}" />
                            </div>
                        </div>

                        <div class="am-popup" id="contactModal">
                            <div class="am-popup-inner">
                                <div class="am-popup-hd">
                                    <h4 class="am-popup-title">选择商务联系人</h4>
                                    <span data-am-modal-close
                                          class="am-close">&times;</span>
                                </div>
                                <div class="am-popup-bd">
                                    <table style="width:100%" class="am-table am-table-compact am-table-striped tpl-table-black " id="example-r">
                                        <thead>
                                            <tr>
                                                <th>用户名</th>
                                                <th>姓名</th>
                                                <th>联系方式</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (INPI.PM.Domain.UserService.User user in ViewBag.users)
                                            {
                                                <tr>
                                                    <td>@user.UserName</td>
                                                    <td>@user.RealName</td>
                                                    <td>@user.PhoneNum</td>
                                                    <td>
                                                        <div class="tpl-table-black-operation">
                                                            <a onclick="selectContact('@user.GUID','@user.RealName')">
                                                                <i class="am-icon-pencil"></i> 选择
                                                            </a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>

                                </div>
                            </div>
                        </div>

                        <div class="am-form-group">
                            <label for="txtCreateTime" class="am-u-sm-3 am-form-label">项目创建日期 <span class="tpl-form-line-small-title">Create Time</span></label>
                            <div class="am-u-sm-9">
                                <input type="text" id="txtCreateDate" name="createDate" class="tpl-form-input" placeholder="请选择项目创建日期" data-am-datepicker readonly />
                            </div>
                        </div>

                        <div class="am-form-group">
                            <label for="txtEstimatedDeliveryDate" class="am-u-sm-3 am-form-label">预计交付日期 <span class="tpl-form-line-small-title">Estimated Time</span></label>
                            <div class="am-u-sm-9">
                                <input type="text" id="txtEstimatedDeliveryDate" name="estimatedDeliveryDate" class="tpl-form-input" placeholder="请选择预计交付日期" data-am-datepicker readonly />
                            </div>
                        </div>

                        <div class="am-form-group">
                            <label for="txtPersonInCharge" class="am-u-sm-3 am-form-label">合同负责人 <span class="tpl-form-line-small-title">Person In Charge</span></label>
                            <div class="am-u-sm-9">
                                <input type="text" id="txtPersonInCharge" name="personInCharge" style="display:none;" />
                                <input type="text" id="txtPersonInChargeName" class="tpl-form-input" placeholder="请选择合同负责人" readonly data-am-modal="{target:'#personInChargeModal'}" />
                            </div>
                        </div>

                        <div class="am-popup" id="personInChargeModal">
                            <div class="am-popup-inner">
                                <div class="am-popup-hd">
                                    <h4 class="am-popup-title">选择合同负责人</h4>
                                    <span data-am-modal-close
                                          class="am-close">&times;</span>
                                </div>
                                <div class="am-popup-bd">
                                    <table style="width:100%" class="am-table am-table-compact am-table-striped tpl-table-black " id="example-r">
                                        <thead>
                                            <tr>
                                                <th>用户名</th>
                                                <th>姓名</th>
                                                <th>联系方式</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (INPI.PM.Domain.UserService.User user in ViewBag.users)
                                            {
                                                <tr>
                                                    <td>@user.UserName</td>
                                                    <td>@user.RealName</td>
                                                    <td>@user.PhoneNum</td>
                                                    <td>
                                                        <div class="tpl-table-black-operation">
                                                            <a onclick="selectPersonInCharge('@user.GUID','@user.RealName')">
                                                                <i class="am-icon-pencil"></i> 选择
                                                            </a>
                                                        </div>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="am-form-group">
                            <label for="upAttachment" class="am-u-sm-3 am-form-label">客户资料 <span class="tpl-form-line-small-title">Attachment</span></label>
                            <div class="am-u-sm-9">
                                <div class="am-form-group am-form-file">
                                    <button type="button" id="upAttachment" class="am-btn am-btn-danger am-btn-sm">
                                        <i class="am-icon-cloud-upload"></i> 添加附件
                                    </button>
                                    <input id="fileAttachment" name="attachment" type="file" multiple="" />
                                </div>
                            </div>
                        </div>

                        <div class="am-form-group">
                            <div class="am-u-sm-9 am-u-sm-push-3">
                                <button type="button" class="am-btn am-btn-primary tpl-btn-bg-color-success" onclick="save()">提交</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    function save() {
        $.ajax({
            url: '/Project/SaveProject',
            data: $("#formProjectInfo").serialize(),
            type: "post",
            success: function (data) {
                if (data.result == 1) {
                    window.location.href = "/Project";
                } else {

                }
            }
        });
    }

    function selectCustomer(guid, name) {
        $("#txtCustomerGuid").val(guid);
        $("#txtCustomerName").val(name);
        var $modal = $("#customerModal");
        $modal.modal("close");
    }

    function selectContact(guid, name) {
        $("#txtContactGuid").val(guid);
        $("#txtContactName").val(name);
        var $modal = $("#contactModal");
        $modal.modal("close");
    }

    function selectPersonInCharge(guid, name) {
        $("#txtPersonInCharge").val(guid);
        $("#txtPersonInChargeName").val(name);
        var $modal = $("#personInChargeModal");
        $modal.modal("close");
    }
</script>

